TOPLEVEL=matrix_mult_wrapper
TESTNAME?=default
SRC_VERILOG=../../src/verilog
APR_FOLDER=../../apr/results
SRC_FOLDER= $(SRC_VERILOG)
SIM=1
SDF=1
RAND_SEED?=42

#Build up a list of verilog define statements to be used by vcs

VERILOG_DEFINES:= 
ifeq ($(SIM), 1)
		VERILOG_DEFINES := $(VERILOG_DEFINES)+SIM=1
endif
ifeq ($(SDF), 1)
		VERILOG_DEFINES := $(VERILOG_DEFINES)+SDF=1
endif




.DEFAULT_GOAL := vcs

# Move all the verilog files from the source directory over to this simulation directory. Being disciplined about file naming
# allows you to automate a lot of these menial and occassionally error inducing tasks.
link_files:
	find $(SRC_FOLDER) -name '*apr.include' -exec ln -s -f {} ';'
	find $(SRC_FOLDER) -name '*_pkg.sv' -exec ln -s -f {} ';'
	find $(SRC_FOLDER) -name 'mem_emulator.sv' -exec ln -s -f {} ';'
	find $(SRC_FOLDER) -name 'tb_*apr.sv' -exec ln -s -f {} ';'
	find $(SRC_FOLDER) -name '*tasks*.sv' -exec ln -s -f {} ';'
	find $(SRC_FOLDER) -name '*.cfg' -exec ln -s -f {} ';'
	find $(APR_FOLDER) -name '*.v' -exec ln -s -f {} ';'
	find $(APR_FOLDER) -name '*.sdf' -exec ln -s -f {} ';'
	ln -s $(APR_FOLDER) apr_results


vcs:$(TOPLEVEL)_apr.include
	mkdir -p golden_log
	touch golden_log/$(TESTNAME).log
	vcs -f $(TOPLEVEL)_apr.include +v2k -R +lint=all -sverilog -full64 \
		-timescale=1ns/10ps -debug_acc+pp+dmptf -debug_region+cell+encrypt \
		-debug_access -l $(TOPLEVEL).log +define+$(VERILOG_DEFINES) +testname=$(TESTNAME) \
		+ntb_random_seed=$(RAND_SEED) -lca -kdb \
		-cm line+cond+tgl+branch+assert
		#simv

vrd:
	verdi -dbdir ./simv.daidir/ &

urg:
	urg -dir simv.vdb -format text -report cover_report

wipe:
	rm -rf *.include
	rm -rf alib-52
	rm -rf $(TOPLEVEL)
	rm -rf simv.daidir
	rm -rf DVEfiles
	rm -rf *_log
	rm -rf *.log
	rm -rf *.vpd
	rm -rf ucli.key
	rm -rf default.svf
	rm -rf simv
	rm -rf *.sv *.v *.svh
	rm -rf csrc
	rm -rf *.fsdb
	rm -rf verdi*
	rm -rf novas*
	rm -rf *.cfg
	rm -rf *.sdf
	rm -rf ./apr_results
	rm -rf ./logs

clean:
	rm -rf DVEfiles
	rm -rf *.log
	rm -rf *.vpd
	rm -rf ucli.key
	rm -rf alib-52
	rm -rf $(TOPLEVEL)
	rm -rf simv.daidir
	rm -rf csrc
	rm -rf simv
	rm -rf *.fsdb
	rm -rf verdi*
	rm -rf novas*

